# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Dart

permissions: write-all

on:
  push:
    tags:
      - "*"

jobs:
  Bu_sadece_isim:
    name: 🤖📦🚀 Burada flutter ve melos kurup version güncellemek istiyoruz.
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v3

      - name: Get Latest Tag and Message
        id: latest_tag_info
        run: |
          latest_tag=$(git tag -l --sort=-version:refname | head -n1)
          tag_info=$(git for-each-ref --format '%(contents)' refs/tags/$latest_tag)
          latest_commit_message=$(git log --format=%B -n 1 $latest_tag)

          echo "latest_tag=$latest_tag" >> $GITHUB_OUTPUT
          echo "tag_info=$tag_info" >> $GITHUB_OUTPUT
          echo "latest_commit_message=$latest_commit_message" >> $GITHUB_OUTPUT

      - name: Use the outputs
        run: |
          echo "Son Etiket: ${{ steps.latest_tag_info.outputs.latest_tag }}"
          echo ----
          echo "Son Etiketin Mesajı: ${{ steps.latest_tag_info.outputs.tag_info }}"
          echo ----
          echo "Son Commit Mesajı: ${{ steps.latest_tag_info.outputs.latest_commit_message }}"

      - name: Check Variable Value
        if: ${{ contains(steps.latest_tag_info.outputs.latest_commit_message, 'deploy') }}
        run: |
          echo "Variable contains the desired value!"
          # İşlemlerinizi buraya ekleyin...
      - name: Variable Does Not Contain Value
        if: ${{ !contains(steps.latest_tag_info.outputs.latest_commit_message, 'deploy') }}
        run: |
          echo "Variable does not contain the desired value."
          # Farklı işlemlerinizi buraya ekleyin...

      - name: 📦🚀 Calculate android package id and fvm flutter version
        id: version
        run: |
          flutter=$(./scripts/fvm_version.sh)
          echo "flutter_version=$flutter" >> $GITHUB_OUTPUT

      # - name: ⚙️ Setup Java
      #   uses: actions/setup-java@v3
      #   id: java
      #   with:
      #     distribution: "zulu"
      #     java-version: "12.x"
      #     cache: "gradle"

      # - name: ⚙️ Setup Flutter
      #   uses: subosito/flutter-action@v2
      #   id: flutter
      #   with:
      #     flutter-version: ${{ steps.version.outputs.flutter }}
      #     channel: "stable"
      #     cache: true

      # - name: Get Flutter SDK Path
      #   id: flutter_path
      #   run: |
      #     FLUTTER_PATH=$(which flutter)
      #     FLUTTER_DIR=$(dirname $(dirname $FLUTTER_PATH))
      #     echo "flutter_directory=$FLUTTER_DIR" >> $GITHUB_OUTPUT

      # - name: 📦🚀 Install Melos
      #   id: melos
      #   run: |
      #     flutter pub global activate melos

      # - name: 📦🚀 Install Melos
      #   id: melos_version
      #   run: |
      #     melos --sdk-path ${{ steps.flutter_path.outputs.flutter_directory }} bs ; melos --sdk-path ${{ steps.flutter_path.outputs.flutter_directory }} version --all ; echo "y"
